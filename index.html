<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Panel Contabilidad</title>
</head>
<body>

<h2>Login Empresa</h2>

<input id="email" placeholder="Correo">
<br><br>
<input id="password" type="password" placeholder="ContraseÃ±a">
<br><br>
<button onclick="login()">Entrar</button>

<hr>

<h3>Pedidos</h3>
<div id="pedidos"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from
  "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getDatabase, ref, onValue } from
  "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "TU_API_KEY",
  authDomain: "TU_PROYECTO.firebaseapp.com",
  databaseURL: "https://TU_PROYECTO.firebaseio.com",
  projectId: "TU_PROYECTO",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

window.login = function () {
  signInWithEmailAndPassword(
    auth,
    document.getElementById("email").value,
    document.getElementById("password").value
  );
};

onAuthStateChanged(auth, user => {
  if (user) cargarEmpresa(user.uid);
});

function cargarEmpresa(uid) {
  const refEmpresa = ref(db, "usuarios/" + uid + "/empresaId");

  onValue(refEmpresa, snap => {
    cargarPedidos(snap.val());
  });
}

function cargarPedidos(empresaId) {
  const refPedidos = ref(db, empresaId + "/Pedidos");

  onValue(refPedidos, snap => {
    let html = "";
    snap.forEach(p => {
      html += `<p>${p.val().nombre || "Pedido"}</p>`;
    });
    document.getElementById("pedidos").innerHTML = html;
  });
}
</script>

</body>
</html>
