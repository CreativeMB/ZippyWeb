<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Base de Datos - Zippy Contabilidad</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; height: 100vh; display: flex; flex-direction: column; }
        header { display: flex; justify-content: flex-end; padding: 10px; background-color: #f2f2f2; }
        #btnCerrarSesion { padding: 6px 12px; }

        #container { display: flex; flex: 1; height: calc(100% - 50px); }
        #sidebar { width: 20%; background-color: #f9f9f9; border-right: 1px solid #ccc; padding: 10px; overflow-y: auto; }
        #sidebar h2 { font-size: 16px; margin-top: 0; }
        #sidebar ul { list-style: none; padding: 0; }
        #sidebar li { padding: 8px; margin-bottom: 5px; background-color: #eee; border-radius: 4px; cursor: pointer; }
        #sidebar li:hover { background-color: #ddd; }

        #main { width: 80%; padding: 10px; overflow-y: auto; }
    </style>
</head>
<body>

<header>
    <button id="btnCerrarSesion"> Cerrar Sesi贸n</button>
</header>

<div id="container">
    <div id="sidebar">
        <h2> Bases de Datos</h2>
        <ul id="listaBases"></ul>
    </div>

    <div id="main">
        <h2> Pedidos</h2>
        <p>Aqu铆 se cargar谩n los pedidos cuando se seleccione una base de datos.</p>
    </div>
</div>

<script>
    // --- CONFIGURAR FIREBASE ---
    const firebaseConfig = {
        apiKey: "AIzaSyBTphfyjQbU1AKt6sYFepJ8Q8mGp3sbtOA",
        authDomain: "zippy-727d5.firebaseapp.com",
        databaseURL: "https://zippy-727d5-default-rtdb.firebaseio.com",
        projectId: "zippy-727d5"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();
    let idEmpresa = null;

    // --- CERRAR SESIN ---
    document.getElementById("btnCerrarSesion").onclick = () => {
        auth.signOut().then(() => {
            alert("Sesi贸n cerrada correctamente");
            window.location.href = "login.html";
        }).catch(error => {
            alert("Error al cerrar sesi贸n: " + error.message);
        });
    };

    // --- Verificar usuario autenticado ---
    auth.onAuthStateChanged(user => {
        if (user) {
            idEmpresa = user.uid;
            cargarBases();
        } else {
            alert("Debe iniciar sesi贸n primero");
            window.location.href = "login.html";
        }
    });

    // --- Cargar bases de datos ---
    function cargarBases() {
        const ref = db.ref(`${idEmpresa}/basededatos`);
        const listaBases = document.getElementById("listaBases");
        listaBases.innerHTML = '';

        ref.on('value', snapshot => {
            listaBases.innerHTML = '';
            snapshot.forEach(baseSnap => {
                const nombreBase = baseSnap.key;
                const li = document.createElement('li');
                li.textContent = nombreBase;

                // Cuando hagan click, podemos capturar la base seleccionada
                li.onclick = () => {
                    alert(`Seleccionaste la base: ${nombreBase}`);
                    // Aqu铆 m谩s adelante cargaremos los pedidos correspondientes
                };

                listaBases.appendChild(li);
            });
        });
    }
</script>

</body>
</html>
